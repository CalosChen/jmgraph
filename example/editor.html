<!doctype html>
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type" />

		<!--[if lt IE 9]>
    <script src="../lib/html5.js" type="text/javascript"></script>    
    <script src="../lib/excanvas.js" type="text/javascript"></script>
    <script type="text/javascript">
	var ltie9 = true;
    </script>
<![endif]-->

		<script type="text/javascript" src="../common/jmUtils.js" ></script>
		<script type="text/javascript" src="../common/jmModels.js" ></script>
			<script type="text/javascript" src="../common/jmProperty.js" ></script>
		<script type="text/javascript" src="../common/jmEvents.js" ></script>
		<script type="text/javascript" src="../common/jmControl.js" ></script>
		<script type="text/javascript" src="../shapes/jmShape.js" ></script>
		<script type="text/javascript" src="../shapes/jmPath.js" ></script>
		<script type="text/javascript" src="../shapes/jmLine.js" ></script>
		<script type="text/javascript" src="../shapes/jmCircle.js" ></script>
				<script type="text/javascript" src="../shapes/jmArc.js" ></script>
				<script type="text/javascript" src="../shapes/jmHArc.js" ></script>
		<script type="text/javascript" src="../shapes/jmPrismatic.js" ></script>
		<script type="text/javascript" src="../shapes/jmBezier.js" ></script>
		<script type="text/javascript" src="../shapes/jmRect.js" ></script>
		<script type="text/javascript" src="../shapes/jmArraw.js" ></script>
		<script type="text/javascript" src="../jmGraph.js" ></script>

		<script type="text/javascript" src="../controls/jmArrowLine.js" ></script>
		<script type="text/javascript" src="../editor/jmCell.js" ></script>
		<script type="text/javascript" src="../editor/jmEditor.js" ></script>

		<script type="text/javascript" src="images.js" ></script>
		<script type="text/javascript">

			function load() {
				var container = document.getElementById('mycanvas');
				var editor = new jmEditor({
					container:container
				});
				var bg = editor.graph.createLinearGradient(0,0,0,'100%');
				bg.addColorStop(0,'#43F589');
				bg.addColorStop(0.5,'#0FA248');
				bg.addColorStop(1,'#43F589');
				var style = {
					stroke:'rgb(138,212,222)',
					fill : bg,
					lineWidth:2,
					close:true,
					radius:6
				};
				style.shadow = new jmShadow(0,0,10,'#0FA248');
				editor.regStyle('process',style);

				editor.regStyle('subflow',style);

				editor.regStyle('switch',style);

				style = jmUtils.clone(style);
				style.fill = '#000';
				style.resizable = false;
				editor.regStyle('fork',style);
				editor.regStyle('join',style);


				style = jmUtils.clone(style);
				style.fill = 'rgb(247,190,32)';
				style.stroke = 'rgb(248,195,60)';
				style.resizable = true;
				editor.regStyle('sbuflow',style);

				var startstyle = jmUtils.clone(style);
				startstyle.resizable = false;
				editor.regStyle('start',startstyle);
				var endstyle = jmUtils.clone(startstyle);
				endstyle.close = true;
				endstyle.lineWidth = 1;
				endstyle.fill = '#64D381';
				editor.regStyle('end',endstyle);
				

				var cell1 = editor.addCell({position :{x:80,y:100},width:100,height:60,shape:'rect',style:'process'});

				var cell2 = editor.addCell({position:{x:500,y:400},width:100,height:100,shape:'circle',style:'sbuflow'});

				cell1.connect(cell2);

				var cell3 = editor.addCell({position:{x:600,y:250},width:100,height:100,shape:'circle',style:'sbuflow'});


				var components = document.getElementById('components');

				var startimg = editor.regComponent(images.start,{width:60,height:60,shape:'arc',style:'start'});
				var li = document.createElement('li');
				li.appendChild(startimg);
				components.appendChild(li);

				var processimg = editor.regComponent(images.process,{width:100,height:80,shape:'arc',style:'process'});
				li = document.createElement('li');
				li.appendChild(processimg);
				components.appendChild(li);

				var subflowimg = editor.regComponent(images.subflow,{width:100,height:80,shape:'rect',style:'subflow'});
				li = document.createElement('li');
				li.appendChild(subflowimg);
				components.appendChild(li);

				var forkimg = editor.regComponent(images.fork,{width:100,height:40,shape:'rect',style:'fork'});
				li = document.createElement('li');
				li.appendChild(forkimg);
				components.appendChild(li);

				var joinimg = editor.regComponent(images.join,{width:100,height:50,shape:'arc',style:'join'});
				li = document.createElement('li');
				li.appendChild(joinimg);
				components.appendChild(li);

				var switchimg = editor.regComponent(images['switch'],{width:100,height:50,shape:'prismatic',style:'switch'});
				li = document.createElement('li');
				li.appendChild(switchimg);
				components.appendChild(li);

				var endimg = editor.regComponent(images.end,{width:60,maxRadius:30,minRadius:20,height:60,start:0,end:Math.PI * 2,anticlockwise:false,shape:'harc',style:'end'});
				li = document.createElement('li');
				li.appendChild(endimg);
				components.appendChild(li);

				editor.graph.paint();

				var btn = document.getElementById('btnZoomOut');
				btn.onclick = function() {
					editor.execute('zoomOut');
				}
				btn = document.getElementById('btnZoomIn');
				btn.onclick = function() {
					editor.execute('zoomIn');
				}
				btn = document.getElementById('btnZoomActual');
				btn.onclick = function() {
					editor.execute('zoomActual');
				}

				btn = document.getElementById('btnExpImage');
				btn.onclick = function() {
					document.getElementById('expimage').src = editor.toImage();
					document.getElementById('expimagearea').style.display = 'inline';
				}
			}
		</script>
	</head>
	<body onload="load()">
		
		<table>
			<tr>
				<td></td>
				<td>
					<button id="btnZoomOut" >缩小</button>
		<button id="btnZoomIn" >放大</button>
		<button id="btnZoomActual" >复原</button>
		<button id="btnExpImage" >导出为图片</button>
	</td>
			</tr>
			<tr>
				<td style="width:150px;vertical-align:top;">
					<ul id="components"></ul>
				</td>
				<td>
			<div id="container">
				<canvas id="mycanvas" width="800" height="600"></canvas>
			</div>
				</td>
			</tr>
		</table>
		<div id="expimagearea" style="display:none;">
			<div style="position:relative; height:60px;">
			<a href="#" style="position:fixed;" onclick="javascript:document.getElementById('expimagearea').style.display='none';">关闭</a>
<span style="color:red;float:right;">请右健另存为: </span>
</div>
<img id="expimage" />
		</div>
	</body>
</html>
<style>
html,body,div{
	width:100%;
	height:100%;
	margin:0;
	padding:0;
}
#components {
	list-style: none;
}
#container {
/*background-color: #000;*/
width:100%;
height:100%;
display:block;
overflow: auto;
}
#container canvas {
	background-image:url(data:image/gif;base64,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);
	margin:0 auto;
	background-color: #000;
}

#expimagearea {
	background-color: #303030;
	color:blue;
	border:1px solid #ccc;
	width:600px;
	height:400px;
	overflow: auto;
	position:absolute;
	left:25%;
	top:150px;
}
</style>